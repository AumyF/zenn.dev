---
title: "レンダリングモードとデータフェッチングの手法と選び方"
emoji: "🌏"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["javascript"]
published: false
---

# この記事について

Next.js や Nuxt、Gatsby のような Web フロントエンドフレームワークには決まって**レンダリングモード**の概念があります。レンダリングモードは **どのタイミングで HTML を生成するか** の戦略です。HTML を生成するためにはその元となるデータが必要になりますから、そのデータの取得 (fetching) 戦略とも切り離すことはできません。

近頃、Web フロントエンドではレンダリングモードを指す 3 文字の略語が飛び交うようになりました。SSR, SSG, ISR といったものです。さらに On-demand ISR や Edge SSR といったような修飾を付け加えた用語も登場してきています。これらの概念がどのように優れているのかを理解して使い分けることで、**利用者体験 (UX)** と **開発者体験 (DX)** をともに高めることができます。

# 用語整理

さっそく最初の Static Genration について説明してもいいのですが、説明がうまく伝わるように、少々退屈でも用語整理から始めましょう。

## レンダー

React や Vue の要素はまず HTML に変換されてからブラウザによって画面上に描画されます。この過程のうち HTML への変換フェーズ、ブラウザによる描画フェーズはともに英語でレンダー (render, 描画) といわれますが、混乱を生じないように、ここでいう「レンダー」は React や Vue の要素を HTML に変換することと定め、ブラウザによる描画は単に描画という語を用いることにします。

## 利用者体験

UX (User Experience) の代表的な指標は **Core Web Vitals** でしょう。

## 開発者体験

DX (Developer Experience) にこれといった指標はありませんが、この記事では以下の指標を導入します。

## 開発ライフサイクル

Web サービスを開発、運用するまでには複数の段階が踏まれます。どのタイミングで何が起きるのかを明確に説明するために、この記事でどのようなライフサイクルイベントが登場するのかこの節で説明しておきます。

### 開発時

サービスを開発するとき、より具体的にはコードを書いているときです。

### ビルド時

サービスをデプロイ (公開のサービスとして本番環境に配備) する前に、ビルドの過程があります。ビルド過程では、TypeScript や新しい仕様の JavaScript をより多くの環境で実行できるように変換したり、複数のモジュールをまとめてバンドルしたりし、実行環境で実行するためのコードを生成します。

古典的には、ビルドは開発を行っているローカルマシン上で行い、生成物を `netlify` や `vercel` といったコマンドでデプロイするということが行なわれてきました^[もっと昔はサーバーに FTP で転送とかでしたっけ？]。現在でもこのような運用は可能ですが、現代では Git リポジトリの特定ブランチに push すると Vercel や Netlify、Cloudflare Pages が提供するビルド環境で自動的にビルドが走り、そのまま生成物がデプロイされるというワークフローをとることもできます。ビルド時間次第で課金対象にもなりえますが、Git でのチーム開発とよく統合されていて良好な開発体験が期待できます。

### リクエスト時

サービスをデプロイした後に、ユーザーが Web サービスにアクセスしてきたときです。ユーザーが操作するユーザーエージェント (一般的には Web ブラウザです) がサービスを提供するサーバーにリクエストに HTTP でリクエストを送信すると、サーバーがレスポンスを返してきます。ブラウザがリクエストを送ってからブラウザに最初のバイトが到達するまでの時間が TTFB (Time To First Byte) です。

ここで重要なのは、ビルドの回数よりもリクエストの回数のほうがずっと多いということです。

### クライアントサイド

Web ブラウザは HTML を取得したらそれを解析し、表示を開始しつつ JavaScript のリクエストも行います。

HTML に最低限のコンテンツが含まれている場合、HTML の表示が完了したタイミングが FCP (First Contentful Paint) です。まだ JavaScript は到着していないか実行が終わっていないので、ボタンなどをクリックしても反応はありません。JavaScript が到着して実行が完了し、ボタンなどにイベントハンドラがセットされた状態になるまでの時間が TTI (Time To Interactive) です。

コンテンツが JavaScript に含まれている場合、JavaScript の読み込みが終わってからコンテンツが表示されます。JavaScript はすでに到着しているので、FCP と TTI は同じになります。

# Clinent-Side Rendering

# Static Rendering 系

## Plain Static Rendering

## Static with Client-Side Fetch

## Static with Build-Time Fetch

## Deferred Static Generation

## Incremental Static Regeneration

## On-demand ISR

# Server-Side Rendering 系

## Serverless SSR

## Edge SSR

## Streaming SSR

## Streaming SSR + React Server Components
